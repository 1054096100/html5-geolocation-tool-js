
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=yes">
    <title>HTML 5 - Geolocation</title>
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.css" />
    <link rel="stylesheet" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.3/js/dojo/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.3/js/esri/css/esri.css">
    <link rel="stylesheet" type="text/css" href="css/Geolocation.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/latest/jquery.mobile.min.js"></script>
    <script src="http://serverapi.arcgisonline.com/jsapi/arcgis/3.3compact/"></script>
    <script src="scripts/LocationHelper.js" type="text/javascript"></script>
</head>

<body>
<div data-role="page" id="page">
    <div data-role="content">
        <div id="map"></div>
    </div>
</div>
    <div id="div1">
        <table id="table1" border="1">
            <tr>
                <td>
                    <div id="altitude">Altitude: N/A</div>
                </td>
                <td>
                    <div id="location">0.00, 0.00</div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="speed">Speed: N/A</div>
                </td>
                <td>
                    <div id="timestamp">0:00:00</div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="heading">Heading: N/A</div>
                </td>
                <td>
                    <div id="accuracy">Accuracy: 0m</div>
                </td>
            </tr>
            <tr>
                <td>
                    <button id="shutOffGeo" type="button" onclick="shutOffGeolocation()">Stop Geolocation</button>
                </td>
                <td>
                    <button id="toggleHighAccuracy" type="button" onclick="toggleHighAccuracy()">High Accuracy On</button>
                </td>
            </tr>
        </table>
    </div>

<button id="sendEmailButton" onclick="sendEmail()">Email CSV</button>
<script type="text/javascript">
    dojo.require("esri.map");

    var map;
    var _helper;

    function init() {

        map = new esri.Map("map",{
            basemap:"topo",
            slider: false
        });

        dojo.connect(map, "onLoad", function () {

            //Some browsers don't show full height after onLoad
            setTimeout(function(){
                map.reposition();
                map.resize();
            },500);

            _helper = new LocationHelper(map);

            _helper.locationDiv = document.getElementById("location");
            _helper.altitudeDiv = document.getElementById("altitude");
            _helper.speedDiv = document.getElementById("speed");
            _helper.headingDiv = document.getElementById("heading");
            _helper.timeStampDiv = document.getElementById("timestamp");
            _helper.accuracyDiv = document.getElementById("accuracy");

            _helper.startGeolocation();

        });
    }

    /**
     * Public function for shutting down the geolocation service.
     */
    function shutOffGeolocation(){

        if(_helper.getWatchId() != null){
            _helper.stopGeolocation();
            $('#shutOffGeo').text("Start Geolocation").button("refresh");
            alert("Geolocation has been shutoff");
        }
        else{
            _helper.startGeolocation();
            $('#shutOffGeo').text("Stop Geolocation").button("refresh");
        }
    }

    /**
     * Public function for toggling the geolocation high-accuracy property on/off
     */
    function toggleHighAccuracy(){

        if(_helper.getHighAccuracy() == true){
            $('#toggleHighAccuracy').text("High Accuracy Off").button("refresh");
            _helper.setHighAccuracy(false);
        }
        else{
            $('#toggleHighAccuracy').text("High Accuracy On").button("refresh");
            _helper.setHighAccuracy(true);
        }
    }

    /**
     * Public function for emailing a CSV file containing geolocation service information.
     */
    function sendEmail(){
        window.open('mailto:myself@example.com?subject=HTML5 Accuracy Data&body=' +
                encodeURIComponent(_helper.getAccuracyCSV()));
    }

    dojo.ready(init);
</script>
</body>
</html>